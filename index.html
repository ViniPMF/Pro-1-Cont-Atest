<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utilitário de Datas e Texto</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #1a1a1a;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 25px;
        }
        .section-box {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input[type="date"], input[type="number"], textarea, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            font-weight: bold;
            color: #007bff;
            margin-top: 10px;
            word-wrap: break-word;
        }
        .attestado-item {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 15px;
        }
        .attestado-item div {
            flex: 1;
        }
        .attestado-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .add-btn, .remove-btn {
            background-color: #28a745;
        }
        .add-btn:hover {
            background-color: #218838;
        }
        .remove-btn {
            background-color: #dc3545;
        }
        .remove-btn:hover {
            background-color: #c82333;
        }
        .total-box {
            margin-top: 20px;
            padding: 15px;
            border: 2px dashed #4CAF50;
            border-radius: 8px;
            background-color: #e8f5e9;
        }
        .char-count-green { color: #28a745; }
        .char-count-yellow { color: #ffc107; }
        .char-count-red { color: #dc3545; }
        .warning-icon { color: #ffc107; margin-left: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Utilitário de Datas e Texto</h1>

    ---
    
    <div class="section-box">
        <h2>1. Contador de Caracteres</h2>
        <label for="texto-input">Cole seu texto aqui:</label>
        <textarea id="texto-input" rows="5" placeholder="Cole o conteúdo para contar os caracteres..."></textarea>
        <p>Total de caracteres: <span id="contador-caracteres" class="result">0/1000</span></p>
    </div>

    ---

    <div class="section-box">
        <h2>2. Somador de Dias à uma Data</h2>
        <div>
            <label for="data-inicio">Data Inicial:</label>
            <input type="date" id="data-inicio">
        </div>
        <div>
            <label for="dias-somar">Número de Dias para Somar:</label>
            <input type="number" id="dias-somar" value="0" min="0">
        </div>
        <button onclick="somarDias()">Calcular Data Final</button>
        <p>Data Final: <span id="data-final" class="result"></span></p>
    </div>

    ---

    <div class="section-box">
        <h2>3. Calculadora de Atestados Médicos</h2>
        <div>
            <label for="modo-soma">Modo de Cálculo:</label>
            <select id="modo-soma" onchange="atualizarTotais()">
                <option value="somar">Somar Duração</option>
                <option value="sobrepor">Sobrepor Datas</option>
            </select>
        </div>
        <br>
        <div id="atestados-container">
            </div>

        <div class="attestado-controls">
            <button class="add-btn" onclick="adicionarAtestado()">Adicionar Atestado</button>
        </div>

        <div class="total-box">
            <h3>Resultados Finais:</h3>
            <p>Total de dias de atestado: <span id="total-dias" class="result">0</span></p>
            <p>Data de retorno: <span id="data-retorno" class="result"></span></p>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        document.getElementById('data-inicio').value = `${year}-${month}-${day}`;
        adicionarAtestado();
    });

    // 1. Contador de Caracteres
    document.getElementById('texto-input').addEventListener('input', function() {
        const texto = this.value;
        const contadorSpan = document.getElementById('contador-caracteres');
        contadorSpan.textContent = `${texto.length}/1000`;
        contadorSpan.className = 'result ';

        if (texto.length < 1000) {
            contadorSpan.classList.add('char-count-green');
        } else if (texto.length === 1000) {
            contadorSpan.classList.add('char-count-yellow');
        } else {
            contadorSpan.classList.add('char-count-red');
        }
    });

    // 2. Somador de Dias à uma Data
    function somarDias() {
        const dataInicioStr = document.getElementById('data-inicio').value;
        const diasSomar = parseInt(document.getElementById('dias-somar').value);

        if (!dataInicioStr || isNaN(diasSomar)) {
            alert("Por favor, preencha a data e os dias corretamente.");
            return;
        }

        const data = new Date(dataInicioStr + 'T00:00:00');
        data.setDate(data.getDate() + diasSomar);

        document.getElementById('data-final').textContent = data.toLocaleDateString('pt-BR');
    }

    // 3. Calculadora de Atestados Médicos
    function adicionarAtestado() {
        const container = document.getElementById('atestados-container');
        const novoAtestado = document.createElement('div');
        novoAtestado.classList.add('attestado-item');
        novoAtestado.innerHTML = `
            <div>
                <label>Data do Atestado:</label>
                <input type="date" class="data-atestado" onchange="atualizarTotais()">
            </div>
            <div>
                <label>Dias de Atestado:</label>
                <input type="number" class="dias-atestado" value="0" min="0" oninput="atualizarTotais()">
            </div>
            <p>Data de Término: <span class="data-termino result"></span><span class="warning-icon" style="display:none">⚠️</span></p>
            <button class="remove-btn" onclick="removerAtestado(this)">Remover</button>
        `;
        container.appendChild(novoAtestado);
        atualizarTotais(); // Atualiza ao adicionar para refletir o estado inicial
    }

    function removerAtestado(btn) {
        const container = document.getElementById('atestados-container');
        container.removeChild(btn.parentNode);
        atualizarTotais();
    }
    
    function atualizarTotais() {
        const modoSoma = document.getElementById('modo-soma').value;
        const atestados = Array.from(document.querySelectorAll('.attestado-item'));

        if (atestados.length === 0) {
            document.getElementById('total-dias').textContent = '0';
            document.getElementById('data-retorno').textContent = '';
            return;
        }

        // Ordenar atestados por data de emissão
        atestados.sort((a, b) => {
            const dataA = new Date(a.querySelector('.data-atestado').value);
            const dataB = new Date(b.querySelector('.data-atestado').value);
            return dataA - dataB;
        });

        let totalDias = 0;
        let ultimaDataFim = null;
        let dataRetorno = null;

        atestados.forEach((atestado, index) => {
            const dataInput = atestado.querySelector('.data-atestado');
            const diasInput = atestado.querySelector('.dias-atestado');
            const dataTerminoSpan = atestado.querySelector('.data-termino');
            const warningIcon = atestado.querySelector('.warning-icon');

            if (dataInput.value && diasInput.value !== '') {
                const dataInicio = new Date(dataInput.value + 'T00:00:00');
                const dias = parseInt(diasInput.value);

                // Calcular e exibir a data de término individual
                const dataTermino = new Date(dataInicio);
                dataTermino.setDate(dataTermino.getDate() + dias);
                dataTerminoSpan.textContent = dataTermino.toLocaleDateString('pt-BR');

                // Lógica de cálculo total
                if (modoSoma === 'somar') {
                    totalDias += dias;
                    // Lógica para aviso de desconexão
                    if (index > 0) {
                        const dataAnteriorInput = atestados[index - 1].querySelector('.data-atestado');
                        const diasAnteriorInput = atestados[index - 1].querySelector('.dias-atestado');
                        if (dataAnteriorInput.value && diasAnteriorInput.value !== '') {
                            const dataAnterior = new Date(dataAnteriorInput.value + 'T00:00:00');
                            const diasAnterior = parseInt(diasAnteriorInput.value);
                            const dataFimAnterior = new Date(dataAnterior);
                            dataFimAnterior.setDate(dataFimAnterior.getDate() + diasAnterior);
                            
                            if (dataInicio > dataFimAnterior) {
                                warningIcon.style.display = 'inline';
                            } else {
                                warningIcon.style.display = 'none';
                            }
                        }
                    } else {
                         warningIcon.style.display = 'none';
                    }
                } else if (modoSoma === 'sobrepor') {
                    if (ultimaDataFim === null) {
                        ultimaDataFim = dataTermino;
                    } else if (dataTermino > ultimaDataFim) {
                        ultimaDataFim = dataTermino;
                    }
                    
                    // Lógica para aviso de desconexão
                    if (index > 0) {
                         const dataAnteriorInput = atestados[index - 1].querySelector('.data-atestado');
                         const diasAnteriorInput = atestados[index - 1].querySelector('.dias-atestado');
                         if (dataAnteriorInput.value && diasAnteriorInput.value !== '') {
                            const dataAnterior = new Date(dataAnteriorInput.value + 'T00:00:00');
                            const diasAnterior = parseInt(diasAnteriorInput.value);
                            const dataFimAnterior = new Date(dataAnterior);
                            dataFimAnterior.setDate(dataFimAnterior.getDate() + diasAnterior);
                            
                            if (dataInicio > dataFimAnterior) {
                                warningIcon.style.display = 'inline';
                            } else {
                                warningIcon.style.display = 'none';
                            }
                        }
                    } else {
                         warningIcon.style.display = 'none';
                    }
                }
            } else {
                dataTerminoSpan.textContent = '';
                warningIcon.style.display = 'none';
            }
        });

        if (modoSoma === 'somar') {
            const dataMaisRecenteAtestado = atestados.reduce((maisRecente, atestado) => {
                const dataAtestado = new Date(atestado.querySelector('.data-atestado').value + 'T00:00:00');
                return dataAtestado > maisRecente ? dataAtestado : maisRecente;
            }, new Date(0));
            
            if (dataMaisRecenteAtestado.getFullYear() > 1970) {
                dataRetorno = new Date(dataMaisRecenteAtestado);
                dataRetorno.setDate(dataRetorno.getDate() + totalDias);
            }
        } else if (modoSoma === 'sobrepor') {
            if (ultimaDataFim) {
                dataRetorno = ultimaDataFim;
            }
             // Lógica para total de dias em modo de sobreposição
             if (atestados.length > 0) {
                const primeiraData = new Date(atestados[0].querySelector('.data-atestado').value);
                const ultimaDataFinal = dataRetorno;
                if (primeiraData && ultimaDataFinal) {
                    const diffTime = Math.abs(ultimaDataFinal.getTime() - primeiraData.getTime());
                    totalDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                }
            }
        }

        document.getElementById('total-dias').textContent = totalDias;
        document.getElementById('data-retorno').textContent = dataRetorno ? dataRetorno.toLocaleDateString('pt-BR') : 'N/A';
    }
</script>

</body>
</html>
